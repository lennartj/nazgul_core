<!--
  ~ Copyright (c) jGuru Europe AB.
  ~ All rights reserved.
  -->

<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://www.osgi.org/xmlns/blueprint/v1.0.0 http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd">

    <!--
        The PropertyHolder instance creates default configuration property values for the HazelcastCacheMember instance.
    -->
    <bean id="propertyHolderSource"
          class="se.jguru.nazgul.core.cache.impl.hazelcast.clients.PropertyHolder"/>

    <!--
        Define an OSGi Hazelcast Cache service.
    -->
    <service interface="se.jguru.nazgul.core.cache.api.Cache">
        <bean class="se.jguru.nazgul.core.cache.impl.hazelcast.clients.HazelcastCacheMember"
              factory-method="create">
            <!--
                final String clusterID,
                final String localIp,
                final int localPort,
                final String clusterMembers
            -->
            <argument>
                <bean factory-ref="propertyHolderSource" factory-method="getCacheClusterId"/>
            </argument>
            <argument>
                <bean factory-ref="propertyHolderSource" factory-method="getLocalListeningIp"/>
            </argument>
            <argument>
                <bean factory-ref="propertyHolderSource" factory-method="getLocalListeningPort"/>
            </argument>
            <argument>
                <bean factory-ref="propertyHolderSource" factory-method="getCacheMembers"/>
            </argument>
        </bean>
    </service>

    <camelContext xmlns="http://camel.apache.org/schema/blueprint">

        <route>
            <from uri="direct:start"/>
            <transform>
                <simple>Hello ${body}</simple>
            </transform>
            <to uri="mock:a"/>
        </route>

    </camelContext>

</blueprint>