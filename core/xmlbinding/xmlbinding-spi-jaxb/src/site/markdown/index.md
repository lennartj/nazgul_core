# Overview: XmlBinding JAXB SPI

The JAXB SPI is an implementation of the XmlBinding API using JAXB technology.
The SPI is intended to be used in any case where JAXB-annotated classes should
be converted to or from XML. The XmlBinding JAXB SPI provides thee main
simplifications and a desirable process over raw JAXB:

1. While the JAXB api itself is fairly useable, it comes with added complexity when
   XML schema validation is required (by default, JAXB does not validate XSD schema
   when marshalling and/or unmarshalling XML). The XmlBinding JAXB SPI simplifies
   both marshalling and unmarshalling - and throws in XML schema validation as well.
2. JAXB is complex when trying to control the exact XSD generated by annotated
   classes - in particular when you wish to manage/control the namespace prefixes
   used within a generated XSD. This is simplified and wrapped by the XmlBinding
   JAXB SPI, encapsulating the functionality within a `JaxbNamespacePrefixResolver`.
3. For classes not compliant with JAXB standards, one can use standard JAXB to
   create a class which implements `XmlAdapter` and also annotate the noncompliant
   field or class with `@XmlJavaTypeAdapter` to indicate the XmlAdapter used.
   However, this approach requires annotations in all places where fields exist
   that JAXB should handle, which is somewhat cumbersome and error-prone. The
   XmlBinding JAXB SPI provides an alternative solution by hosting a generally
   available type converter registry used to convert to and from transport types.

There are typically two use cases for the JAXB SPI - marshalling Objects to XML
and unmarshalling XML to Objects. Let's have a look at both these cases:

## Marshalling Java Objects to XML

Typically, marshalling of Java objects into XML is used to acquire
a language-neutral transport form before sending data over the network
in message or request form. Also, marshalling a configuration object
into XML and storing it in a file is a simple way to provide an easy-to-read
configuration file.

<pre class="brush: java" title="Example marshal method use."><![CDATA[
// Create the xml binder
final JaxbXmlBinder binder = new JaxbXmlBinder();

// Marshal a set of objects into XML
final Person person1 = new Person("Lennart", 44);
final Person person2 = new Person("Malin", 478);
final String xml = unitUnderTest.marshal(person1, "FooBar!", null, person2);
]]></pre>

The XML generated by the JaxbXmlBinder in its default configuration contains
two main elements, as shown in the XML snippet below:

1. The **entityClasses** element contains the class names of all transport types contained
   within the message. This type information is required if you want to unmarshal the types
   using JAXB; and the XmlBinding JAXB SPI makes use of this type information to simplify
   unmarshalling.
2. The **items** element contains the actual marshalled XML data. Note that some type
   conversion is done under the covers to convert normally un-marshallable data types to
   something that JAXB can work with. (In the example snippet below, note that the
   original `null` value has been converted to a `JaxbAnnotatedNull` transport type, which
   has been marshalled into the XML message).

<pre class="brush: xml" title="Example marshalled data."><![CDATA[
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<core:entityTransporter xmlns:xs="http://www.w3.org/2001/XMLSchema"
      xmlns:core="http://www.jguru.se/nazgul/core"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <entityClasses>
        <entityClass>java.lang.String</entityClass>
        <entityClass>se.jguru.nazgul.core.xmlbinding.spi.jaxb.helper.types.Person</entityClass>
        <entityClass>se.jguru.nazgul.core.xmlbinding.spi.jaxb.transport.EntityTransporter</entityClass>
        <entityClass>se.jguru.nazgul.core.xmlbinding.spi.jaxb.transport.type.JaxbAnnotatedNull</entityClass>
    </entityClasses>
    <items>
        <item xsi:type="core:person" age="44">
            <name>Lennart</name>
        </item>
        <item xsi:type="xs:string">FooBar!</item>
        <item xsi:type="core:jaxbAnnotatedNull"/>
        <item xsi:type="core:person" age="478">
            <name>Malin</name>
        </item>
    </items>
</core:entityTransporter>
]]></pre>


## Unmarshalling XML to Java Objects

Typically, unmarshalling Java Objects from XML is used to resurrect/re-create the memory state
of Java Objects previously written to XML form. If the XML data has been generated by the
XmlBinding JAXB SPI, it can be resurrected in a simple manner:

<pre class="brush: java" title="Example unmarshal method use."><![CDATA[
// Create the xml binder
final JaxbXmlBinder binder = new JaxbXmlBinder();

// Unmarshal XML to resurrect the objects previously written
final Reader input = ... read XML data from a stream connected to a file/socket/whatever ...
final List<Object> result = unitUnderTest.unmarshal(input);

// The result list now contains the objects previously marshalled, as per above.
]]></pre>

