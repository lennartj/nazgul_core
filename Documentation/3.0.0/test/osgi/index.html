<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.4 at 2017-04-22 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20170422" />
    <meta http-equiv="Content-Language" content="en" />
    <title>nazgul-core-osgi-test &#x2013; Nazgul Core: OSGi Test</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
      <script type="text/javascript" src="./js/apache-maven-fluido-1.6.min.js"></script>
<!-- Add syntax highlighter -->
            <link href="http://alexgorbatchev.com/pub/sh/current/styles/shThemeDefault.css"
                  rel="stylesheet"
                  type="text/css"/>
            <link href="http://alexgorbatchev.com/pub/sh/current/styles/shCore.css"
                  rel="stylesheet"
                  type="text/css"/>
            <script src="http://alexgorbatchev.com/pub/sh/current/scripts/shCore.js"
                    type="text/javascript"></script>
            <script src="http://alexgorbatchev.com/pub/sh/current/scripts/shBrushJava.js"
                    type="text/javascript"></script>
            <script src="http://alexgorbatchev.com/pub/sh/current/scripts/shBrushJScript.js"
                    type="text/javascript"></script>
            <script src="http://alexgorbatchev.com/pub/sh/current/scripts/shBrushXml.js"
                    type="text/javascript"></script>
      </head>
    <body class="topBarDisabled">
      <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2><span style="color: #777777;">nazgul-core-osgi-test</span></h2>
</div>
</div>
        <div class="pull-right"><div id="bannerRight"><h2>Nazgul Framework: Core</h2>
</div>
</div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="projectVersion">Version: 3.0.0</li>
        <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2017-04-22</li>
      <li class="pull-right"><span class="divider">|</span>
<a href="http://bitbucket.org/lennartj" class="externalLink" title="Bitbucket">Bitbucket</a></li>
      <li class="pull-right"><a href="http://maven.apache.org/" class="externalLink" title="Maven">Maven</a></li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
          <li class="nav-header">Overview</li>
    <li class="active"><a href="#"><span class="none"></span>Introduction</a>
  </li>
          <li class="nav-header">Parent Project</li>
    <li><a href="../../core/poms/core-parent/index.html" title="nazgul-core-parent"><span class="none"></span>nazgul-core-parent</a>  </li>
                      <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a>  </li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-down"></span>Project Reports</a>
      <ul class="nav nav-list">
    <li class="active"><a href="#"><span class="none"></span>AspectJ Report</a>
  </li>
    <li><a href="apidocs/index.html" title="JavaDocs"><span class="none"></span>JavaDocs</a>  </li>
    <li><a href="testapidocs/index.html" title="Test JavaDocs"><span class="none"></span>Test JavaDocs</a>  </li>
    <li><a href="xref/index.html" title="Source Xref"><span class="none"></span>Source Xref</a>  </li>
    <li><a href="xref-test/index.html" title="Test Source Xref"><span class="none"></span>Test Source Xref</a>  </li>
    <li><a href="checkstyle.html" title="Checkstyle"><span class="none"></span>Checkstyle</a>  </li>
    <li><a href="findbugs.html" title="FindBugs"><span class="none"></span>FindBugs</a>  </li>
    <li><a href="property-updates-report.html" title="Property Updates Report"><span class="none"></span>Property Updates Report</a>  </li>
    <li><a href="dependency-updates-report.html" title="Dependency Updates Report"><span class="none"></span>Dependency Updates Report</a>  </li>
    <li><a href="plugin-updates-report.html" title="Plugin Updates Report"><span class="none"></span>Plugin Updates Report</a>  </li>
      </ul>
  </li>
  </ul>
          <hr />
          <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<h1>Nazgul Core: OSGi Test</h1>
<p>The Nazgul Core: OSGi Test provides a set of classes that implement some of the frequently occurring OSGi interfaces and sporting a (unit-)test-friendly internal mechanics which can be set up as required in unit tests. Use this project when you need to write unit tests for OSGi services. Include the Nazgul Core: OSGi Test project into your OSGi-enabled project in the following manner (note the <b>test</b> scope):</p>

<div>
<pre class="brush: xml">
        &lt;dependency&gt;
            &lt;groupId&gt;se.jguru.nazgul.test.osgi&lt;/groupId&gt;
            &lt;artifactId&gt;nazgul-core-osgi-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
</pre></div>
<div class="section">
<div class="section">
<h3><a name="Why_is_this_required"></a>Why is this required?</h3>
<p>Testing OSGi components can be quite taxing on the developer. On the one hand, OSGi is a very POJO-inspired technology which means testing implementations in isolation is trivial. On the other hand, the OSGi container is a highly asynchronous platform for dependency injection, which makes unit testing very complex. The complexity of unit testing OSGi applications is accentuated by the fact that the OSGi container injects both implementation libraries (i.e. JARs) and services (i.e. Objects) in an asynchronous manner.</p>
<p>If you have not developed OSGi applications, testing something developed around POJO principles may sound like a trivial exercise. This is true only when creating tests that do not rely on any OSGi mechanics such as events and dependency injection of objects - but these things are what makes OSGi containers attractive runtime containers and are very frequently used in OSGi applications.</p>
<p>An example illustrates the mocked OSGi integration:</p></div>
<div class="section">
<h3><a name="Example:_OSGi_events_in_a_synchronous_unit-test_environment"></a>Example: OSGi events in a synchronous unit-test environment</h3>
<p>The OSGi container directs events to listeners which are required to implement various interfaces. This is an example of a BundleListener implementation for unit test purposes:</p>

<div>
<pre class="brush: java" title="Prelude: An OSGi BundleListener class">

    public class TracingBundleListener implements BundleListener {

    public List&lt;BundleEvent&gt; callTrace = new ArrayList&lt;BundleEvent&gt;();
    public CountDownLatch onEventLatch;

    // Internal state
    private String id;

    /**
     * Creates a non-blocking TracingBundleListener instance.
     */
    public TracingBundleListener(final String id) {
        this(-1, id);
    }

    /**
     * Creates a TracingBundleListener instance holding a non-null onEventLatch with the given count.
     * The count of the onEventLatch is  decreased whenever the bundleChanged method is called.
     * For any value of countDownValue less than 1, no CountDownLatch will be created.
     *
     * @param countDownValue The countDown value of the created onEventLatch.
     * @see #onEventLatch
     */
    public TracingBundleListener(final int countDownValue, final String id) {

        this.id = id;
        if (countDownValue &gt; 0) {
            onEventLatch = new CountDownLatch(countDownValue);
        }
    }

    /**
     * Receives notification that a bundle has had a lifecycle change.
     *
     * @param event The {@code BundleEvent}.
     */
    @Override
    public void bundleChanged(final BundleEvent event) {

        callTrace.add(event);

        if (onEventLatch != null) {
            onEventLatch.countDown();
        }
    }

    /**
     * @return The id of this TracingBundleListener.
     */
    public String getId() {
        return id;
    }
}
</pre></div>
<p>The listener above is used in a test case to illustrate that the MockBundle sends and stores events internally in the correct order an of the correct type. Note that the MockBundle class (&#x201c;unitUnderTest&#x201d;) stems from the Nazgul Core: OSGi Test project:</p>

<div>
<pre class="brush: java" title="OSGi-ified Unit Test using Nazgul Core: OSGi Test">

    // Shared state
    private String osgiStringVersion = &quot;1.2.3.SNAPSHOT&quot;;
    private MockBundle unitUnderTest;

    @Before
    public void setupSharedState() {
        unitUnderTest = new MockBundle(osgiStringVersion);
    }

    @Test
    public void validateListenerCallbacksOnStartStopLifecycle() throws BundleException {

        // Assemble
        final TracingBundleListener bundleListener = new TracingBundleListener(&quot;testId&quot;);
        unitUnderTest.getBundleContext().addBundleListener(bundleListener);

        // Act
        unitUnderTest.start();
        unitUnderTest.stop();

        // Assert
        final List&lt;BundleEvent&gt; callTrace = bundleListener.callTrace;
        Assert.assertEquals(2, callTrace.size());
        Assert.assertEquals(BundleEvent.STARTED, callTrace.get(0).getType());
        Assert.assertEquals(BundleEvent.STOPPED, callTrace.get(1).getType());
    }
</pre></div></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
<!-- Launch the syntax highlighter. -->
            <script type="text/javascript">
                SyntaxHighlighter.all()
            </script>
        </div>
        </div>
    </footer>
    </body>
</html>
