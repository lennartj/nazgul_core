<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2016-07-01 
 | Rendered using Apache Maven Fluido Skin 1.4
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20160701" />
    <meta http-equiv="Content-Language" content="en" />
    <title>nazgul-core-persistence-model &#x2013; Example: JPA annotations for collections within Entities</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.4.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.4.min.js"></script>

                          
        
<link rel="stylesheet" href="http://alexgorbatchev.com/pub/sh/current/styles/shThemeDefault.css" type="text/css"/>
                      
        
<link rel="stylesheet" href="http://alexgorbatchev.com/pub/sh/current/styles/shCore.css" type="text/css"/>
                      
        
<script src="http://alexgorbatchev.com/pub/sh/current/scripts/shCore.js" type="text/javascript"></script>
                      
        
<script src="http://alexgorbatchev.com/pub/sh/current/scripts/shBrushJava.js" type="text/javascript"></script>
                      
        
<script src="http://alexgorbatchev.com/pub/sh/current/scripts/shBrushJScript.js" type="text/javascript"></script>
                      
        
<script src="http://alexgorbatchev.com/pub/sh/current/scripts/shBrushXml.js" type="text/javascript"></script>
          
                  </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2><span style="color: #777777;">nazgul-core-persistence-model</span></h2>
                </div>
                      </div>
        <div class="pull-right">              <div id="bannerRight">
                <h2>Nazgul Framework: Core</h2>
                </div>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="projectVersion">Version: 1.8.1
                    </li>
              
                
                    
                  <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2016-07-01</li>
            
                                    
    <li class="pull-right">
        <span class="divider">|</span>
                      <a href="../../../../.." title="Bitbucket">
        Bitbucket</a>
      </li>

  
    <li class="pull-right">
                      <a href="http://maven.apache.org/" class="externalLink" title="Maven">
        Maven</a>
      </li>

                    </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Overview</li>
                              
      <li>
  
                          <a href="index.html" title="Introduction">
          <span class="none"></span>
        Introduction</a>
            </li>
                
      <li class="active">
  
            <a href="#"><span class="none"></span>Example: Standard Cache API usage</a>
          </li>
                                                                                <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                        
      <li>
  
                          <a href="project-info.html" title="Project Information">
          <span class="icon-chevron-right"></span>
        Project Information</a>
                  </li>
                                                                                                                                                                                                                                                                        
      <li>
  
                          <a href="project-reports.html" title="Project Reports">
          <span class="icon-chevron-right"></span>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            <div class="section">
<h2><a name="Example:_JPA_annotations_for_collections_within_Entities"></a>Example: JPA annotations for collections within Entities</h2>
<p>In trying to hide certain underlying database complexities, the JPA specification introduces a set of quite complex annotations which can sometimes be difficult to relate to the corresponding database constructs. These complexities tend to manifest themselves when object oriented mechanics are not immediately translatable to relational database structures, such as when an Entity class contains collections of data.</p>
<p>Relational databases cannot inherently represent collections - each cell within a database table can normally only contain a single value. Instead, relational databases use (foreign) keys to relate a single row within a table (holding the entity state) to a set of rows within another table (holding the data within the collection). Since relational database table cells can generally only contain a single value, we arrive at slew of scenarios depending where Primitive and and Entity data types are used:</p>

<ol style="list-style-type: decimal">
  
<li>Primitive keys, Primitive values.  Use @ElementCollection, @MapKeyColumn and @Column annotations.</li>
  
<li>Primitive keys, Entity values.  Use @ElementCollection and @MapKeyJoinColumn annotations.</li>
  
<li>
<p>Entity keys, Entity values.  Use @OneToMany or @ManyToMany and @MapKeyJoinColumn annotations.</p>
  
<div class="source">
<div class="source"><pre class="prettyprint linenums">//
// MapKeyColumn used for basic types of Map keys
// MapKeyJoinColumn used for entity types of Map keys
//
// If generics are not used in the Map declaration,
// use @MapKeyClass to define the key type, and
// targetClass property of @ElementCollection to
// define value type.
//
</pre></div></div></li>
</ol></div>
<div class="section">
<h2><a name="Scenario_1:_Map_of_primitive_data_types"></a>Scenario 1: Map of primitive data types</h2>
<p>When the collection (or Map) contains primitive values (i.e. not objects/entities), a single cell can contain the key or value. Therefore, the JPA provider needs only create one extra table to manage the collection. An example of this is a Map relating String keys to String values which is realized as follows in a database:</p>
<p><img src="images/plantuml/jpa_primitive_collections.png" style="margin:10px; border:1px solid black;" alt="" /></p>
<p>The extra table created to hold the values within the collection is called <tt>member_contactdetails</tt> - and its name is given to the JPA provider in the <tt>@CollectionTable</tt> annotation. Summarizing the relevant JPA annotations to create the table structure above:</p>

<table border="0" class="table table-striped">
    
<tr class="a">
        
<th>Annotation</th>
        
<th>Example</th>
        
<th>Description</th>
    </tr>
    
<tr class="b">
        
<td>@ElementCollection</td>
        
<td>@ElementCollection</td>
        
<td>Tells the JPA provider that a collection or map should contain only primitives / elements (i.e.
        no entities).</td>
    </tr>
    
<tr class="a">
        
<td>@CollectionTable</td>
        
<td>@CollectionTable(name = &quot;member_contactdetails&quot;)</td>
        
<td>Defines the name of the database table where the Map values are stored</td>
    </tr>
    
<tr class="b">
        
<td>@MapKeyColumn</td>
        
<td>@MapKeyColumn(name = &quot;contact_type&quot;)</td>
        
<td>Defines the name of the column where the Map's keys are stored</td>
    </tr>
    
<tr class="a">
        
<td>@Column</td>
        
<td>@Column(name = &quot;address_or_number&quot;)</td>
        
<td>Defines the name of the column where the Map's values are stored</td>
    </tr>
</table>
<p>the name of the Map&#x2019;s key column is <tt>contact_type</tt> which is supplied in the annotation <tt>@MapKeyColumn</tt>, and and value column&#x2019;s name <tt>address_or_number</tt> is given in the <tt>@Column</tt> annotation. Finally, the <tt>@ElementCollection</tt> annotation is used to let the JPA provider know not to create any additional synthetic tables. The resulting annotated JPA code is shown below:</p>

<div>
<pre class="brush: java" title="Map with primitive elements (ElementCollection)">
    @ElementCollection
    @CollectionTable(name = &quot;member_contactdetails&quot;)
    @MapKeyColumn(name = &quot;contact_type&quot;)
    @Column(name = &quot;address_or_number&quot;)
    private Map&lt;String, String&gt; contactDetails;
</pre></div></div>
<div class="section">
<h2><a name="Scenario_2:_Sensibly_named_Collections_of_Entities"></a>Scenario 2: (Sensibly named) Collections of Entities</h2>
<p>When the collection (or Map) contains entities (i.e. not primitive values), a single cell can <b>not</b> contain the key or value. Therefore, the JPA provider needs to create two extra tables to manage the collection. The first of these two tables is frequently known as a &#x201c;jump table&#x201d; in database lingo, exemplified by a table named GuildMembership in this example. Imagine that members in a Society can be part of one or many Guilds, and that each Guild must have at least one guildmaster. The GuildMembership table links Members to Guilds, and adds some information indicating who is a guildmaster to each relationship row. We can model this is several ways; one of these ways is illustrated below:</p>
<p><img src="images/plantuml/jpa_entity_relations.png" style="margin:10px; border:1px solid black;" alt="" /></p>
<p>The Membership entity class has a Set of GuildMemberships, each of which relates to a Guild and indicates if the GuildMembership in question is the guild master. The collection in the Membership class indicates that the GuildMembership class&#x2019;s field <tt>membership</tt> is used to create the collection:</p>

<div>
<pre class="brush: java" title="Collection/Set of Entities (Entity Relation)">
    @OneToMany(mappedBy = &quot;membership&quot;, fetch = FetchType.EAGER, cascade = CascadeType.ALL)
    private Set&lt;GuildMembership&gt; guildMemberships;</pre></div>
<p>The GuildMembership entity has a compound primary key, which consists of a pair of primary key values from the Guild and Membership tables. For this to work, JPA requires that the key of the GuildMaster table is represented by a separate class containing each pair of primary keys. The corresponding java class diagram of the relation above indicates that the GuildMembership is a JPA entity that uses a compound key instead of a plain one:</p>
<p><img src="images/plantuml/jpa_jumptable_compound_key.png" style="margin:10px; border:1px solid black;" alt="" /></p></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                                                          
<script type="text/javascript">SyntaxHighlighter.all()</script>
                          </div>

        
                </div>
    </footer>
        </body>
</html>
